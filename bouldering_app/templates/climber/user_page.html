{% extends 'base.html' %}

{% block content %}
<section class="content">
    <header>
        <h1>Welcome, {{ g.user['username'] }}</h1>
    </header>
    
    <p>Your profile page is under construction.</p>
    <h1>All Boulders</h1>

    {% if boulders %}
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="text-center">Name</th>
                    <th class="text-center">Color of Holds</th>
                    <th class="text-center">Difficulty</th>
                    <th class="text-center">Number of Moves</th>
                    <th class="text-center">Attempts</th>
                    <th class="text-center">Status</th>
                    <th class="text-center">Attempt Date</th> <!-- New column -->
                    <th class="text-center">Log Ascent</th>
                </tr>
            </thead>
            <tbody>
                {% for boulder in boulders %}
                <tr>
                    <td>{{ boulder.name }}</td>
                    <td style="background-color: {{ boulder.color }};"></td>
                    <td>V{{ boulder.difficulty }}</td>
                    <td>{{ boulder.numberofmoves }}</td>
                    
                    {% set attempts_for_boulder = [] %}
                    {% for attempt in attempts %}
                        {% if attempt.boulder_id == boulder.id %}
                            {% set attempts_for_boulder = attempts_for_boulder.append(attempt) %}
                        {% endif %}
                    {% endfor %}

                    {% if attempts_for_boulder %}
                        {% set attempt = attempts_for_boulder[0] %}
                        <td>{{ attempt.number_of_attempts }}</td>
                        <td>{{ attempt.status }}</td>
                        <td>{{ attempt.attempt_date }}</td>
                        <td>
                            <a class="btn btn-warning" href="{{ url_for('log_ascent.log_ascent_user', id=boulder.id, attempt_id=attempt.id) }}">Update Log</a>
                        </td>
                    {% else %}
                        <td>0</td>
                        <td>No log record yet</td>
                        <td>N/A</td> 
                        <td>
                            <a class="btn btn-warning" href="{{ url_for('log_ascent.log_ascent_user', id=boulder.id) }}">Log</a>
                        </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>            
        </table>
    {% else %}
        <p>No boulders found.</p>
    {% endif %}

    <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Log Out</a>
</section>
{% endblock %}
