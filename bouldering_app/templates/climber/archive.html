{% extends 'base.html' %}

{% block content %}
<section class="content">
    <header>
        <h1>Archived Boulders</h1>
    </header>

    {% if archived_boulders %}
        <table class="table table-striped table-bordered" id="archivedBoulderTable" style="background-color: #ffffff;">
            <thead>
                <tr>
                    <th class="text-center">Name</th>
                    <th class="text-center">Color of Holds</th>
                    <th class="text-center">Difficulty</th>
                    <th class="text-center">Number of Moves</th>
                    <th class="text-center">Attempts</th>
                    <th class="text-center">Status</th>
                    <th class="text-center">Attempt Date</th>
                    <th class="text-center">Log Ascent</th>
                </tr>
            </thead>
            <tbody>
                {% for boulder in archived_boulders %}
                <tr>
                    <td class="text-center align-middle">{{ boulder.name }}</td>
                    <td class="align-middle">
                        <div class="card" style="background-color: {{ boulder.color }}; width: 30px; height: 30px; border-radius: 50%;"></div>
                    </td>
                    <td class="text-center align-middle">V{{ boulder.difficulty }}</td>
                    <td class="text-center align-middle total-moves">{{ boulder.numberofmoves }}</td>

                    {% set attempts_for_boulder = [] %}
                    {% for attempt in attempts %}
                        {% if attempt.boulder_id == boulder.id %}
                            {% set _ = attempts_for_boulder.append(attempt) %}
                        {% endif %}
                    {% endfor %}

                    {% if attempts_for_boulder %}
                        {% set attempt = attempts_for_boulder[0] %}
                        <td class="text-center align-middle attempts">{{ attempt.number_of_attempts }}</td>
                        <td class="text-center align-middle status">
                            {% if attempt.status == 'flashed' %}
                                Flashed
                            {% elif attempt.status == 'completed' %}
                                Completed
                            {% elif attempt.status == 'incomplete' %}
                                Incomplete ({{ attempt.moves_completed }} / {{ boulder.numberofmoves }} moves)
                            {% endif %}
                        </td>
                        <td class="text-center align-middle">{{ attempt.attempt_date }}</td>
                    {% else %}
                        <td class="text-center align-middle attempts">0</td>
                        <td class="text-center align-middle status">No log record yet</td>
                        <td class="text-center align-middle">N/A</td>
                    {% endif %}

                    <td class="text-center align-middle"><a class="btn btn-warning" href="{{ url_for('log_ascent.log_ascent_user', id=boulder.id) }}">Log</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No archived boulders found.</p>
    {% endif %}

    <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Log Out</a>
    <a href="{{ url_for('auth.user_page') }}" class="btn btn-primary">Home</a>
</section>
{% endblock %}
